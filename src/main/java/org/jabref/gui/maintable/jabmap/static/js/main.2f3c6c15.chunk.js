(this["webpackJsonpmind-map"]=this["webpackJsonpmind-map"]||[]).push([[0],{136:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(12),c=n.n(r),i=(n(85),n(26)),d=n(37),l=n.n(d),s=n(54),u=n(27),f=n(67),p=n(19),h=(n(49),n(14)),m=function(e){var t=e.node,n=(e.id,e.colors,e.updateEdges),a=e.setSelectedNode,r=e.selectedNodeId,c=e.updateNode,i=(e.label,e.bibEntryId,e.isInSearch);return o.a.createElement(h.Group,{id:t.id,x:t.x_pos,y:t.y_pos,draggable:!0,onDragMove:function(e){t.x_pos=e.target.x(),t.y_pos=e.target.y(),c(t),n(t.id,e.target.x(),e.target.y())},onClick:function(){return a(t)}},o.a.createElement(h.Rect,{radius:{x:50,y:30},width:150,height:70,offsetX:75,offsetY:35,cornerRadius:20,fill:i?"red":r===t.id?"#a2b8e5":"white",stroke:void 0===t.colour?"#6E6E6E":t.colour,strokeWidth:4}),o.a.createElement(h.Text,{text:t.label,offsetX:75,offsetY:45,align:"center",verticalAlign:"middle",width:150,height:70}),o.a.createElement(h.Group,{width:150,height:70,offsetX:65,offsetY:-15},t.citationKey&&o.a.createElement(h.Rect,{width:10,height:10,fill:"red"})))},b=function(e){var t=e.x1,n=e.y1,a=e.x2,r=e.y2,c={st:[t,n],ct:[t,r,t,r],en:[a,r]};return o.a.createElement(h.Shape,{stroke:"#50618F",strokeWidth:6,lineCap:"round",sceneFunc:function(e,t){e.beginPath(),e.moveTo.apply(e,Object(i.a)(c.st)),e.bezierCurveTo.apply(e,Object(i.a)(c.ct).concat(Object(i.a)(c.en))),e.strokeShape(t)}})},g=n(164),v=function(e){var t=e.nodes,n=e.edges,a=e.updateEdges,r=e.setSelectedNode,c=e.selectedNodeId,i=e.updateNode;Object(g.a)({canvas:{left:"25%",position:"absolute"}})();return o.a.createElement(h.Group,{x:310},n.map((function(e){return o.a.createElement(b,{x1:e.startX,y1:e.startY,x2:e.endX,y2:e.endY})})),t.map((function(e){return o.a.createElement(m,{node:e,key:e.id,label:e.label,colors:e.colors,id:e.id,x:e.x_pos,y:e.y_pos,colour:e.colour,updateEdges:a,selectedNodeId:c,setSelectedNode:r,updateNode:i,isInSearch:e.isInSearch})})))},E=o.a.memo((function(e){var t=e.references,n=(e.setReferences,e.addNode),r=e.layerRef,c=e.stageRef,i=(Object(g.a)({table:{position:"absolute",left:0,top:0,maxWidth:"25%",overflow:"hidden",tableLayout:"fixed",height:"100vh",backgroundColor:"#e1e1e1"}})(),t.length),d=o.a.useRef([]);return d.current.length!==i&&(d.current=Array(i).fill().map((function(e,t){return d.current[t]||Object(a.createRef)()}))),o.a.createElement(h.Group,null,t.map((function(e,t){return o.a.createElement(h.Group,null,o.a.createElement(h.Group,{y:110*t},o.a.createElement(h.Rect,{width:300,height:100,fill:"#dddddd"}),o.a.createElement(h.Text,{text:e.title,x:150,y:50,width:100,height:60})),o.a.createElement(h.Group,{opacity:.5,draggable:!0,ref:d.current[t],position:{x:0,y:110*t},onDragEnd:function(){d.current[t].current.position({x:0,y:110*t}),r.current.draw();var a=c.current.getPointerPosition(),o=a.x,i=a.y;n(e,o-300,i,e.citekey)}},o.a.createElement(h.Rect,{width:300,height:100,fill:"#dddddd"}),o.a.createElement(h.Text,{text:e.title,x:150,y:50,width:100,height:60})))})))}));function y(){var e=window;return{windowWidth:e.innerWidth,windowHeight:e.innerHeight}}var w=n(175),j=o.a.memo((function(e){var t=e.addNode,n=e.saveMap,r=e.deleteNode,c=e.searchNodes,i=e.changeNodeColor;console.log("toolbar render");var d=Object(g.a)({toolbar:{width:"100%",textAlign:"center"}})(),l=Object(a.useRef)(null);return window.onkeydown=function(e){(114===e.keyCode||e.ctrlKey&&70===e.keyCode)&&(e.preventDefault(),l.current.focus())},o.a.createElement("div",{className:d.toolbar},o.a.createElement(w.a,{onClick:function(){return t()}},"Add Node"),o.a.createElement(w.a,{onClick:function(){return n()}},"Save Map"),o.a.createElement(w.a,{onClick:r},"Delete Node"),o.a.createElement("input",{id:"nodeColor",type:"color",onChange:i}),o.a.createElement("input",{type:"text",id:"searchnode",onChange:c,ref:l,placeholder:"\ud83d\udd0eNode Search",size:"30"}))})),x=n(168),O=n(170),N=n(171),I=n(172),k=n(173),S=n(169),_=n(174),R=function(e){var t=e.node,n=e.reference,r=e.updateNode,c=Object(g.a)({panel:{position:"absolute",top:10,right:10,width:"300px",height:"400px",backgroundColor:"#dddddd"}})(),i=Object(a.useRef)(),d=Object(a.useState)(),l=Object(p.a)(d,2),s=l[0],u=l[1];Object(a.useEffect)((function(){u(t.label),i.current.focus()}),[t]);return o.a.createElement(x.a,{className:c.panel},o.a.createElement(S.a,{gutterBottom:!0,variant:"h4",component:"h4",style:{textAlign:"center"}},"Node Info"),o.a.createElement(_.a,{style:{width:"90%",marginBottom:"20px",marginLeft:"5%"},id:"standard-basic",label:"Label",value:s,type:"text",inputRef:i,onChange:function(e){u(e.target.value),t.label=e.target.value,r(t)}}),n&&o.a.createElement(O.a,{className:c.table,"aria-label":"simple table"},o.a.createElement(S.a,{gutterBottom:!0,style:{marginLeft:"5%"},variant:"h5",component:"h5"},"BibEntry"),o.a.createElement(N.a,null,o.a.createElement(I.a,{key:n.title},o.a.createElement(k.a,{component:"td",scope:"row"},"Title:"),o.a.createElement(k.a,{component:"td",scope:"row"},n.title)),o.a.createElement(I.a,{key:n.author},o.a.createElement(k.a,{component:"td",scope:"row"},"Author:"),o.a.createElement(k.a,{component:"td",scope:"row"},n.author)),o.a.createElement(I.a,{key:n.year},o.a.createElement(k.a,{component:"td",scope:"row"},"Year:"),o.a.createElement(k.a,{component:"td",scope:"row"},n.year)))))};var C=function(){var e=Object(a.useState)([]),t=Object(p.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)([]),d=Object(p.a)(c,2),m=d[0],b=d[1],w=Object(a.useState)([{}]),x=Object(p.a)(w,2),O=x[0],N=x[1],I=Object(a.useState)({}),k=Object(p.a)(I,2),S=k[0],_=k[1],C=Object(a.useState)(4),Y=Object(p.a)(C,2),X=(Y[0],Y[1],function(e){var t=n.map((function(t){return e.id===t.id?e:t}));r(t)}),T=function(e){n.forEach((function(t){e.indexOf(t.id)>-1?t.isInSearch=!0:t.isInSearch=!1,X(t)}))},W=Object(g.a)({wrapper:{position:"relative"},canvas:{left:"25%",position:"absolute"}})(),G=function(){var e=Object(s.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("http://localhost:9898/libraries/current/map").then((function(e){return e.json()})).then((function(e){console.log(e),r(e.nodes),b(e.edges.map((function(t){var n=e.nodes.find((function(e){return e.id===t.node1_Id}));console.log(n);var a=e.nodes.find((function(e){return e.id===t.node2_Id}));return console.log(a),{startId:t.node1_Id,startX:n.x_pos,startY:n.y_pos,endId:t.node2_Id,endX:a.x_pos,endY:a.y_pos}})))})).catch(console.log);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(s.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("http://localhost:9898/libraries/current/entries").then((function(e){return e.json()})).then((function(e){console.log(e),N(e)})).catch(console.log);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){L(),G()}),[]);var M=function(e,t,a){if(void 0!==S.id){var o,c;console.log(S),void 0===e?o="New Node":(c=e.citekey,o=e.title),void 0===t&&(t=0),void 0===a&&(a=400);var d={id:Math.floor(1e9*Math.random()),label:o,x_pos:t,y_pos:a,citationKey:c};r([].concat(Object(i.a)(n),[d]));var l={startId:S.id,startX:S.x_pos,startY:S.y_pos,endId:d.id,endX:d.x_pos,endY:d.y_pos};b([].concat(Object(i.a)(m),[l]))}},A=Object(a.useRef)(),B=Object(a.useRef)(),z=function(){var e=Object(a.useState)(y()),t=Object(p.a)(e,2),n=t[0],o=t[1];return Object(a.useEffect)((function(){function e(){o(y())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),D=z.windowHeight,K=z.windowWidth;return o.a.createElement("div",{className:W.wrapper},o.a.createElement(j,{addNode:M,saveMap:function(){console.log(n);var e=m.map((function(e){return{node1_Id:e.startId,node2_Id:e.endId}})),t=JSON.stringify({nodes:n,edges:e});fetch("http://localhost:9898/libraries/current/map",{method:"PUT",headers:{"Content-Type":"application/json"},body:t})},deleteNode:function(){void 0!==S.id&&(r(n.filter((function(e){return e.id!==S.id}))),b(m.filter((function(e){return e.startId!==S.id&&e.endId!==S.id}))))},searchNodes:function(e){var t=e.target.value,a=[];""!==t?(n.forEach((function(e){e.label.indexOf(t)>-1&&a.push(e.id)})),T(a)):T(a)},changeNodeColor:function(e){var t=e.target.value;!function(e,t){console.log(t);var a=n.map((function(n){return n.id===e?(console.log("match"),Object(u.a)(Object(u.a)({},n),{},{colour:t})):n}));r(a)}(S.id,t)}}),o.a.createElement(h.Stage,{width:K,height:D,ref:B},o.a.createElement(h.Layer,{ref:A},o.a.createElement(E,{references:O,setReferences:N,addNode:M,layerRef:A,stageRef:B}),o.a.createElement(v,{nodes:n,edges:m,updateEdges:function(e,t,n){var a=m.map((function(a){return a.startId===e?Object(u.a)(Object(u.a)({},a),{},{startX:t,startY:n}):a.endId===e?Object(u.a)(Object(u.a)({},a),{},{endX:t,endY:n}):a}));b(a)},updateNode:X,selectedNodeId:S.id,setSelectedNode:_,updateSearchIndex:T}))),S.id?o.a.createElement(R,{node:S,reference:function(e){var t,n=Object(f.a)(O);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.citekey===e)return a}}catch(o){n.e(o)}finally{n.f()}}(S.citationKey),updateNode:X}):o.a.createElement(R,{node:S,updateNode:X}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(C,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},49:function(e,t,n){},81:function(e,t,n){e.exports=n(136)},85:function(e,t,n){}},[[81,1,2]]]);
//# sourceMappingURL=main.2f3c6c15.chunk.js.map