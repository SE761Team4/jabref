(this["webpackJsonpmind-map"]=this["webpackJsonpmind-map"]||[]).push([[0],{104:function(e,t,n){},172:function(e,t,n){e.exports=n(391)},176:function(e,t,n){},224:function(e,t,n){},390:function(e,t,n){},391:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(14),c=n.n(o),i=(n(176),n(38)),l=n(56),d=n.n(l),s=n(101),u=n(29),f=n(152),p=n(24),m=(n(104),n(16)),h=function(e){var t=e.node,n=(e.id,e.colors,e.updateEdges),a=e.setSelectedNode,o=e.selectedNodeId,c=e.updateNode,i=(e.label,e.bibEntryId,e.isInSearch);return r.a.createElement(m.Group,{id:t.id,x:t.x_pos,y:t.y_pos,draggable:!0,onDragMove:function(e){t.x_pos=e.target.x(),t.y_pos=e.target.y(),c(t),n(t.id,e.target.x(),e.target.y())},onClick:function(){return a(t)},onMouseEnter:function(e){e.target.getStage().container().style.cursor="pointer"},onMouseLeave:function(e){e.target.getStage().container().style.cursor="default"}},r.a.createElement(m.Rect,{radius:{x:50,y:30},width:150,height:70,offsetX:75,offsetY:35,cornerRadius:20,fill:i?"#3f51b5":o===t.id?"#a2b8e5":"white",stroke:void 0===t.colour?"#6E6E6E":t.colour,strokeWidth:4}),r.a.createElement(m.Text,{text:t.label,offsetX:75,offsetY:45,align:"center",verticalAlign:"middle",width:150,height:70}),r.a.createElement(m.Group,{width:150,height:70,offsetX:65,offsetY:-15},t.citationKey&&r.a.createElement(m.Rect,{width:10,height:10,fill:"red"})))},b=function(e){var t=e.x1,n=e.y1,a=e.x2,o=e.y2,c={st:[t,n],ct:[t,o,t,o],en:[a,o]};return r.a.createElement(m.Shape,{stroke:"#50618F",strokeWidth:6,lineCap:"round",sceneFunc:function(e,t){e.beginPath(),e.moveTo.apply(e,Object(i.a)(c.st)),e.bezierCurveTo.apply(e,Object(i.a)(c.ct).concat(Object(i.a)(c.en))),e.strokeShape(t)}})},g=n(420),E=function(e){var t=e.nodes,n=e.edges,a=e.updateEdges,o=e.setSelectedNode,c=e.selectedNodeId,i=e.updateNode;Object(g.a)({canvas:{left:"25%",position:"absolute"}})();return r.a.createElement(m.Group,{x:310},n.map((function(e){return r.a.createElement(b,{x1:e.startX,y1:e.startY,x2:e.endX,y2:e.endY})})),t.map((function(e){return r.a.createElement(h,{node:e,key:e.id,label:e.label,colors:e.colors,id:e.id,x:e.x_pos,y:e.y_pos,colour:e.colour,updateEdges:a,selectedNodeId:c,setSelectedNode:o,updateNode:i,isInSearch:e.isInSearch})})))};r.a.memo((function(e){var t=e.references,n=(e.setReferences,e.addNode),o=e.layerRef,c=e.stageRef,i=(Object(g.a)({table:{position:"absolute",left:0,top:0,maxWidth:"25%",overflow:"hidden",tableLayout:"fixed",height:"100vh",backgroundColor:"#e1e1e1"}})(),t.length),l=r.a.useRef([]);return l.current.length!==i&&(l.current=Array(i).fill().map((function(e,t){return l.current[t]||Object(a.createRef)()}))),r.a.createElement(m.Group,null,t.map((function(e,t){return r.a.createElement(m.Group,null,r.a.createElement(m.Group,{y:110*t},r.a.createElement(m.Rect,{width:300,height:100,fill:"#dddddd"}),r.a.createElement(m.Text,{text:e.title,x:150,y:50,width:100,height:60})),r.a.createElement(m.Group,{opacity:.5,draggable:!0,ref:l.current[t],position:{x:0,y:110*t},onDragEnd:function(){l.current[t].current.position({x:0,y:110*t}),o.current.draw();var a=c.current.getPointerPosition(),r=a.x,i=a.y;n(e,r-300,i,e.citekey)}},r.a.createElement(m.Rect,{width:300,height:100,fill:"#dddddd"}),r.a.createElement(m.Text,{text:e.title,x:150,y:50,width:100,height:60})))})))}));function y(){var e=window;return{windowWidth:e.innerWidth,windowHeight:e.innerHeight}}function v(){var e=Object(a.useState)(y()),t=Object(p.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){function e(){r(y())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}var w=n(423),x=(n(224),n(392)),O=n(432),j=n(157),N=n.n(j),k=n(160),I=n.n(k),S=n(159),_=n.n(S),R=n(158),C=n.n(R),Y=r.a.memo((function(e){var t=e.addNode,n=e.saveMap,o=e.deleteNode,c=e.searchNodes,i=e.linking,l=e.setLinking,d=(Object(g.a)({toolbar:{width:"100%",textAlign:"center"}})(),Object(a.useRef)(null));return window.onkeydown=function(e){(114===e.keyCode||e.ctrlKey&&70===e.keyCode)&&(e.preventDefault(),d.current.focus())},r.a.createElement(w.a,{className:"Toolbar-proportions",component:x.a},r.a.createElement("div",{style:{padding:"0.5em"}},r.a.createElement(O.a,{size:"small","aria-label":"add",onClick:function(){return t()}},r.a.createElement(N.a,null)),r.a.createElement(O.a,{size:"small",onClick:function(){return l(!i)},color:i?"primary":"default"},r.a.createElement(C.a,null)),r.a.createElement(O.a,{size:"small",onClick:o},r.a.createElement(_.a,null))),r.a.createElement(O.a,{size:"small",onClick:function(){return n()},style:{paddingLeft:"0.5em"}},r.a.createElement(I.a,null)),r.a.createElement("div",{style:{align:"right",padding:"0.5em"}},r.a.createElement("input",{type:"text",id:"searchnode",onChange:c,ref:d,placeholder:"Node Search",size:"30"})))})),L=n(161),A=n(425),T=n(427),X=n(428),P=n(429),z=n(430),B=n(426),D=n(431),W=function(e){var t=e.node,n=e.reference,o=e.updateNode,c=e.changeNodeColor,i=Object(g.a)({panel:{position:"absolute",top:74,right:10,width:"300px",backgroundColor:"white","& td":{border:"none",padding:"10px"}}})(),l=Object(a.useRef)(),d=Object(a.useState)(),s=Object(p.a)(d,2),u=s[0],f=s[1];Object(a.useEffect)((function(){f(t.label),l.current.focus()}),[t]);return r.a.createElement(A.a,{className:i.panel},r.a.createElement(B.a,{gutterBottom:!0,variant:"h4",component:"h4",style:{textAlign:"center"}},"Node Info"),r.a.createElement(D.a,{style:{width:"calc(100% - 20px)",marginBottom:"10px",marginLeft:"10px"},InputLabelProps:{shrink:!0},id:"standard-basic",label:"Label",value:u,type:"text",inputRef:l,onChange:function(e){f(e.target.value),t.label=e.target.value,o(t)}}),r.a.createElement(T.a,{key:"colorEditor"},r.a.createElement(X.a,{component:"td",scope:"row",style:{border:"none",color:"#3f51b5"}},"Color:"),r.a.createElement(X.a,{component:"td",scope:"row",style:{border:"none"}},r.a.createElement(L.CirclePicker,{colors:["#BA1D2A","#FC6A38","#55773B","#279DA3","#0E5756"],onChange:c}))),n&&r.a.createElement(P.a,{className:i.table,"aria-label":"simple table"},r.a.createElement(B.a,{gutterBottom:!0,style:{paddingLeft:"10px",margin:0},variant:"h5",component:"h5"},"BibEntry"),r.a.createElement(z.a,null,r.a.createElement(T.a,{key:n.title},r.a.createElement(X.a,{component:"td",scope:"row",style:{color:"#3f51b5"}},"Title:"),r.a.createElement(X.a,{component:"td",scope:"row"},n.title)),r.a.createElement(T.a,{key:n.author},r.a.createElement(X.a,{component:"td",scope:"row",style:{color:"#3f51b5"}},"Author:"),r.a.createElement(X.a,{component:"td",scope:"row"},n.author)),r.a.createElement(T.a,{key:n.year},r.a.createElement(X.a,{component:"td",scope:"row",style:{color:"#3f51b5"}},"Year:"),r.a.createElement(X.a,{component:"td",scope:"row"},n.year)))))},M=(n(390),r.a.memo((function(e){var t=e.references,n=(e.setReferences,e.draggedRow),a=(e.addNode,v()),o=a.windowHeight;a.windowWidth;return r.a.createElement("div",{className:"Table-proportions",style:{maxHeight:o-70}},r.a.createElement(A.a,{style:{width:"99.5%"}},r.a.createElement(B.a,{gutterBottom:!0,variant:"h4",component:"h4",style:{textAlign:"center"}},"References"),r.a.createElement("div",null,r.a.createElement(P.a,{hover:!0,size:"sm",className:"table-striped"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Title"),r.a.createElement("th",null,"Author"),r.a.createElement("th",null,"Year"))),r.a.createElement("tbody",null,t&&t.map((function(e){return r.a.createElement(T.a,{key:e,draggable:!0,onDragStart:function(t){n.current=e}},r.a.createElement("td",null,e.title),r.a.createElement("td",null,e.author),r.a.createElement("td",null,e.year))})))))))})));var G=function(){var e=Object(a.useState)([]),t=Object(p.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)([]),l=Object(p.a)(c,2),h=l[0],b=l[1],y=Object(a.useState)([{}]),w=Object(p.a)(y,2),x=w[0],O=w[1],j=Object(a.useState)({}),N=Object(p.a)(j,2),k=N[0],I=N[1],S=Object(a.useState)(4),_=Object(p.a)(S,2),R=(_[0],_[1],Object(a.useState)(!1)),C=Object(p.a)(R,2),L=C[0],A=C[1],T=function(e){L?(H(k,e),A(!1),I(e)):I(e)},X=function(e){var t=n.map((function(t){return e.id===t.id?e:t}));o(t)},P=function(e){n.forEach((function(t){e.indexOf(t.id)>-1?t.isInSearch=!0:t.isInSearch=!1,X(t)}))},z=Object(g.a)({wrapper:{position:"relative"},canvas:{left:"25%",position:"absolute"}})(),B=function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("libraries/current/map").then((function(e){return e.json()})).then((function(e){o(e.nodes.map((function(e){return-1===e.id?Object(u.a)(Object(u.a)({},e),{},{x_pos:$/8,y_pos:U/3}):e}))),b(e.edges.map((function(t){var n=e.nodes.find((function(e){return e.id===t.node1_Id})),a=e.nodes.find((function(e){return e.id===t.node2_Id}));return{startId:t.node1_Id,startX:n.x_pos,startY:n.y_pos,endId:t.node2_Id,endX:a.x_pos,endY:a.y_pos}})))})).catch(console.log);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("/libraries/current/entries").then((function(e){return e.json()})).then((function(e){O(e)})).catch(console.log);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){D(),B(),console.log(k)}),[]);var G=function(e,t,a){if(void 0!==k.id){var r,c;console.log(k),void 0===e?r="New Node":(c=e.citekey,r=e.title),void 0===t&&(t=0),void 0===a&&(a=400);var l={id:Math.floor(1e9*Math.random()),label:r,x_pos:t,y_pos:a,citationKey:c};o([].concat(Object(i.a)(n),[l])),H(k,l),T(l)}},H=function(e,t){if(e.id!==t.id){var n={startId:e.id,startX:e.x_pos,startY:e.y_pos,endId:t.id,endX:t.x_pos,endY:t.y_pos};b([].concat(Object(i.a)(h),[n]))}},K=Object(a.useRef)(),F=Object(a.useRef)(),J=v(),U=J.windowHeight,$=J.windowWidth,q=Object(a.useRef)();return r.a.createElement("div",{className:z.wrapper},r.a.createElement(Y,{addNode:G,saveMap:function(){var e=h.map((function(e){return{node1_Id:e.startId,node2_Id:e.endId}})),t=JSON.stringify({nodes:n,edges:e});fetch("libraries/current/map",{method:"PUT",headers:{"Content-Type":"application/json"},body:t})},deleteNode:function(){void 0!==k.id&&(o(n.filter((function(e){return e.id!==k.id}))),b(h.filter((function(e){return e.startId!==k.id&&e.endId!==k.id}))))},searchNodes:function(e){var t=e.target.value,a=[];""!==t?(n.forEach((function(e){e.label.indexOf(t)>-1&&a.push(e.id)})),P(a)):P(a)},linking:L,setLinking:A}),r.a.createElement(M,{draggedRow:q,addNode:G,references:x,setReferences:O}),r.a.createElement("div",{onDrop:function(e){F.current.setPointersPositions(e);var t=F.current.getPointerPosition(),n=t.x,a=t.y;G(q.current,n-.25*U-75,a)},onDragOver:function(e){return e.preventDefault()}},r.a.createElement(m.Stage,{style:{left:"25%",position:"absolute",top:"64px",margin:0,padding:0},width:.75*$,height:U-64,ref:F},r.a.createElement(m.Layer,{ref:K},r.a.createElement(E,{nodes:n,edges:h,updateEdges:function(e,t,n){var a=h.map((function(a){return a.startId===e?Object(u.a)(Object(u.a)({},a),{},{startX:t,startY:n}):a.endId===e?Object(u.a)(Object(u.a)({},a),{},{endX:t,endY:n}):a}));b(a)},updateNode:X,selectedNodeId:k.id,setSelectedNode:T,updateSearchIndex:P})))),k.id?r.a.createElement(W,{node:k,reference:function(e){var t,n=Object(f.a)(x);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.citekey===e)return a}}catch(r){n.e(r)}finally{n.f()}}(k.citationKey),updateNode:X,changeNodeColor:function(e,t){!function(e,t){var a=n.map((function(n){return n.id===e?Object(u.a)(Object(u.a)({},n),{},{colour:t}):n}));o(a)}(k.id,e.hex)}}):r.a.createElement(W,{node:k,updateNode:X}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(G,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[172,1,2]]]);
//# sourceMappingURL=main.43b4ec4c.chunk.js.map